<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriPadi VR 360Â° Tour</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
        /* ===================================
           GLOBAL STYLES
        =================================== */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ===================================
           ZOOM CONTROLS
        =================================== */
        #zoom-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
        }

        .zoom-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: #45a049;
        }

        .zoom-btn:active {
            transform: scale(0.95);
        }

        /* ===================================
           COORDINATE HELPER
        =================================== */
        #coordinate-helper {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #4CAF50;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            z-index: 1000;
            min-width: 300px;
            border: 2px solid #4CAF50;
        }

        #coordinate-helper h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
            font-size: 16px;
        }

        #coordinate-helper div {
            margin: 5px 0;
            color: #E0E0E0;
        }

        .helper-toggle-btn {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .helper-toggle-btn.active {
            background: #4CAF50;
        }

        /* ===================================
           INFO CARD (2D Overlay)
        =================================== */
        #info-card-2d {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            z-index: 1000;
        }

        #info-card-2d h2 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 18px;
        }

        #info-card-2d .location-badge {
            background: #2196F3;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }

        #info-card-2d p {
            margin: 10px 0 0 0;
            color: #666;
            line-height: 1.5;
        }

        #info-card-2d .minimize-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ddd;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        #info-card-2d.minimized {
            width: 50px;
            height: 50px;
            padding: 10px;
            overflow: hidden;
        }

        #info-card-2d.minimized > *:not(.minimize-btn) {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ===================================
         2D UI OVERLAY
    =================================== -->

    <!-- Zoom Controls -->
    <div id="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">Zoom In (+)</button>
        <button class="zoom-btn" onclick="zoomOut()">Zoom Out (-)</button>
        <button class="zoom-btn" onclick="resetZoom()">Reset Zoom</button>
    </div>

    <!-- Coordinate Helper -->
    <div id="coordinate-helper">
        <h3>Coordinate Helper</h3>
        <div>Click on the 360 image to get coordinates</div>
        <div id="position-display">Position: Click to see</div>
        <div id="rotation-display">Rotation: Click to see</div>
        <div id="camera-rotation">Camera: X:0Â° Y:0Â° Z:0Â°</div>
        <button class="helper-toggle-btn" id="helper-toggle" onclick="toggleHelperMode()">
            Helper Mode: <span id="helper-status">OFF</span>
        </button>
    </div>

    <!-- Info Card (2D Overlay) -->
    <div id="info-card-2d">
        <button class="minimize-btn" onclick="toggleInfoCard()">âˆ’</button>
        <span class="location-badge" id="location-badge">Location 1 of 11</span>
        <h2 id="location-title">Starting Point - Paddy Fields</h2>
        <p id="location-description">Welcome to the beginning of your agricultural journey.</p>
        <p style="font-size: 12px; color: #999; margin-top: 15px;">
            <strong>Tips:</strong> Drag to look around, click checkpoints to navigate, use zoom controls at the bottom.
        </p>
    </div>

    <!-- ===================================
         A-FRAME VR SCENE
    =================================== -->
    <a-scene cursor="rayOrigin: mouse">
        <!-- Camera -->
        <a-entity id="camera" camera look-controls position="0 1.6 0">
            <a-cursor color="#4CAF50"></a-cursor>
        </a-entity>

        <!-- Assets -->
        <a-assets>
            <img id="image1" src="1.jpg">
            <img id="image2" src="2.jpg">
            <img id="image3" src="3.jpg">
            <img id="image4" src="4.jpg">
            <img id="image5" src="5.jpg">
            <img id="image6" src="6.jpg">
            <img id="image7" src="7.jpg">
            <img id="image8" src="8.jpg">
            <img id="image9" src="9.jpg">
            <img id="image10" src="10.jpg">
            <img id="image11" src="11.jpg">
        </a-assets>

        <!-- 360Â° Sky -->
        <a-sky id="sky" src="#image1" rotation="0 -130 0"></a-sky>

        <!-- 3D Info Panel Container (Dynamically Built) -->
        <a-entity id="info-panel-3d" position="0 1.6 -5" rotation="0 0 0"></a-entity>

        <!-- Navigation Checkpoints for Each Image -->
        <!-- Image 1 Checkpoints -->
        <a-entity id="checkpoints-img1" visible="true">
            <a-entity class="checkpoint" position="-2.5 1.5 -10" data-target="2">
                <a-cylinder color="#FF6B6B" radius="0.25" height="0.03" rotation="90 0 0"></a-cylinder>
                <a-cone color="#FFFFFF" radius-bottom="0.12" radius-top="0" height="0.3" rotation="0 0 180" position="0 0.2 0"></a-cone>
                <a-ring color="#FF6B6B" radius-inner="0.28" radius-outer="0.35" rotation="90 0 0">
                    <a-animation attribute="scale" from="1 1 1" to="1.3 1.3 1.3" dur="1500" repeat="indefinite" direction="alternate"></a-animation>
                    <a-animation attribute="opacity" from="1" to="0.3" dur="1500" repeat="indefinite" direction="alternate"></a-animation>
                </a-ring>
                <a-circle color="#000000" radius="0.1" position="0 -0.3 0" rotation="90 0 0">
                    <a-text value="2" align="center" position="0 0 0.05" width="1.5" color="#FFFFFF"></a-text>
                </a-circle>
                <a-text value="Next Location" align="center" position="0 -0.5 0" width="2" color="#FFFFFF"></a-text>
                <a-animation attribute="position" direction="alternate" dur="2000" to="-2.5 1.65 -10" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- Image 2 Checkpoints -->
        <a-entity id="checkpoints-img2" visible="false">
            <a-entity class="checkpoint" position="2 1.5 10" data-target="3">
                <a-cylinder color="#4ECDC4" radius="0.25" height="0.03" rotation="90 0 0"></a-cylinder>
                <a-cone color="#FFFFFF" radius-bottom="0.12" radius-top="0" height="0.3" rotation="0 0 180" position="0 0.2 0"></a-cone>
                <a-ring color="#4ECDC4" radius-inner="0.28" radius-outer="0.35" rotation="90 0 0">
                    <a-animation attribute="scale" from="1 1 1" to="1.3 1.3 1.3" dur="1500" repeat="indefinite" direction="alternate"></a-animation>
                    <a-animation attribute="opacity" from="1" to="0.3" dur="1500" repeat="indefinite" direction="alternate"></a-animation>
                </a-ring>
                <a-circle color="#000000" radius="0.1" position="0 -0.3 0" rotation="90 0 0">
                    <a-text value="3" align="center" position="0 0 0.05" width="1.5" color="#FFFFFF"></a-text>
                </a-circle>
                <a-text value="Next Location" align="center" position="0 -0.5 0" width="2" color="#FFFFFF"></a-text>
                <a-animation attribute="position" direction="alternate" dur="2000" to="2 1.65 10" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- Additional checkpoint groups for images 3-11 would go here -->
        <!-- Keeping it simple for readability -->

    </a-scene>

    <!-- ===================================
         JAVASCRIPT
    =================================== -->
    <script>
        // ===================================
        // CONFIGURATION
        // ===================================
        const CONFIG = {
            totalImages: 11,
            defaultZoom: 80,
            minZoom: 50,
            maxZoom: 100,
            zoomStep: 10,
            cardWidth: 2.8
        };

        // ===================================
        // STATE
        // ===================================
        let currentImageIndex = 1;
        let currentZoom = CONFIG.defaultZoom;
        let helperMode = false;
        let markerCounter = 0;

        // ===================================
        // LOCATION DATA
        // ===================================
        const LOCATIONS = {
            1: {
                title: "Starting Point - Paddy Fields",
                description: "Welcome to the beginning of your agricultural journey. These lush paddy fields represent the backbone of local farming, where traditional rice cultivation methods meet modern techniques."
            },
            2: {
                title: "Irrigation System",
                description: "Modern irrigation infrastructure ensuring consistent water supply to crops throughout the growing season."
            },
            3: {
                title: "Crop Diversity Zone",
                description: "This section demonstrates crop rotation and diversity, essential practices for maintaining soil health and maximizing yield throughout the seasons."
            },
            4: {
                title: "Harvesting Area",
                description: "Active harvesting zone showcasing both traditional and mechanized farming techniques in action."
            },
            5: {
                title: "Storage Facility",
                description: "Post-harvest storage and processing area where crops are prepared for market distribution."
            },
            6: {
                title: "Equipment Shed",
                description: "Modern agricultural equipment and tools used for efficient farm operations."
            },
            7: {
                title: "Composting Area",
                description: "Sustainable waste management zone where organic matter is converted into nutrient-rich compost."
            },
            8: {
                title: "Nursery Section",
                description: "Seedling nursery where young plants are carefully cultivated before transplanting."
            },
            9: {
                title: "Research Plot",
                description: "Experimental area for testing new farming techniques and crop varieties."
            },
            10: {
                title: "Water Management",
                description: "Advanced water conservation and management system supporting sustainable agriculture."
            },
            11: {
                title: "Farm Gate",
                description: "Exit point and distribution area where harvested products begin their journey to market."
            }
        };

        // ===================================
        // ZOOM FUNCTIONS
        // ===================================
        function zoomIn() {
            if (currentZoom > CONFIG.minZoom) {
                currentZoom -= CONFIG.zoomStep;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentZoom < CONFIG.maxZoom) {
                currentZoom += CONFIG.zoomStep;
                updateZoom();
            }
        }

        function resetZoom() {
            currentZoom = CONFIG.defaultZoom;
            updateZoom();
        }

        function updateZoom() {
            const camera = document.querySelector('#camera');
            camera.setAttribute('camera', 'fov', currentZoom);
        }

        // ===================================
        // NAVIGATION FUNCTIONS
        // ===================================
        function goToImage(imageNumber) {
            currentImageIndex = imageNumber;
            updateScene();
        }

        function updateScene() {
            // Update sky
            const sky = document.querySelector('#sky');
            sky.setAttribute('src', `#image${currentImageIndex}`);

            // Update checkpoints visibility
            for (let i = 1; i <= CONFIG.totalImages; i++) {
                const checkpoints = document.querySelector(`#checkpoints-img${i}`);
                if (checkpoints) {
                    checkpoints.setAttribute('visible', i === currentImageIndex);
                }
            }

            // Update info cards
            update2DInfoCard();
            update3DInfoPanel();
        }

        // ===================================
        // INFO CARD FUNCTIONS
        // ===================================
        function update2DInfoCard() {
            const location = LOCATIONS[currentImageIndex];
            document.getElementById('location-badge').textContent = `Location ${currentImageIndex} of ${CONFIG.totalImages}`;
            document.getElementById('location-title').textContent = location.title;
            document.getElementById('location-description').textContent = location.description;
        }

        function toggleInfoCard() {
            const card = document.getElementById('info-card-2d');
            const btn = card.querySelector('.minimize-btn');
            card.classList.toggle('minimized');
            btn.textContent = card.classList.contains('minimized') ? '+' : 'âˆ’';
        }

        // ===================================
        // 3D INFO PANEL (DYNAMIC CREATION)
        // ===================================
        function update3DInfoPanel() {
            const location = LOCATIONS[currentImageIndex];
            const panel = document.getElementById('info-panel-3d');

            // Split description into lines (40 chars max per line)
            const lines = splitTextIntoLines(location.description, 40);

            // Calculate card height based on content
            const baseHeight = 1.3;
            const lineHeight = 0.2;
            const totalHeight = baseHeight + (lines.length * lineHeight);
            const halfHeight = totalHeight / 2;

            // Build card dynamically
            panel.innerHTML = buildInfoCardHTML(location, lines, totalHeight, halfHeight);

            console.log(`Built 3D card: ${totalHeight.toFixed(2)}h for ${lines.length} lines`);
        }

        function splitTextIntoLines(text, maxChars) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';

            words.forEach(word => {
                if ((currentLine + word).length < maxChars) {
                    currentLine += (currentLine ? ' ' : '') + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            });
            if (currentLine) lines.push(currentLine);

            return lines;
        }

        function buildInfoCardHTML(location, lines, totalHeight, halfHeight) {
            const w = CONFIG.cardWidth;

            let html = `
                <!-- Borders & Background -->
                <a-plane color="#00D9FF" width="${w + 0.3}" height="${totalHeight + 0.3}" opacity="0.3" position="0 0 -0.03">
                    <a-animation attribute="opacity" from="0.2" to="0.4" dur="2000" repeat="indefinite" direction="alternate"></a-animation>
                </a-plane>
                <a-plane color="#1a1a2e" width="${w + 0.2}" height="${totalHeight + 0.2}" opacity="0.95" position="0 0 -0.02"></a-plane>
                <a-plane color="#00D9FF" width="${w + 0.15}" height="${totalHeight + 0.15}" opacity="1" position="0 0 -0.015"></a-plane>
                <a-plane color="#16213e" width="${w}" height="${totalHeight}" opacity="0.98"></a-plane>

                <!-- Top Bar -->
                <a-plane color="#00D9FF" width="${w}" height="0.15" position="0 ${halfHeight - 0.075} 0.01" opacity="0.9"></a-plane>
                <a-plane color="#FFD700" width="0.15" height="0.15" position="${-w/2 + 0.075} ${halfHeight - 0.075} 0.015"></a-plane>
                <a-plane color="#FFD700" width="0.15" height="0.15" position="${w/2 - 0.075} ${halfHeight - 0.075} 0.015"></a-plane>

                <!-- Badge -->
                <a-plane color="#000000" width="1.8" height="0.12" position="0 ${halfHeight - 0.25} 0.015" opacity="0.7"></a-plane>
                <a-text value="LOCATION ${currentImageIndex} / ${CONFIG.totalImages}" align="center"
                        position="0 ${halfHeight - 0.25} 0.02" width="3.5" color="#FFD700"></a-text>

                <!-- Title -->
                <a-plane color="#0F3460" width="${w - 0.2}" height="0.3" position="0 ${halfHeight - 0.52} 0.015" opacity="0.9"></a-plane>
                <a-text value="${location.title}" align="center"
                        position="0 ${halfHeight - 0.52} 0.02" width="4.2" color="#FFFFFF"></a-text>

                <!-- Divider -->
                <a-plane color="#00D9FF" width="${w - 0.4}" height="0.02" position="0 ${halfHeight - 0.72} 0.015" opacity="0.6"></a-plane>
            `;

            // Description lines
            let currentY = halfHeight - 0.92;
            lines.forEach(line => {
                html += `<a-text value="${line}" align="center" position="0 ${currentY} 0.02" width="4.8" color="#E0E0E0"></a-text>`;
                currentY -= 0.2;
            });

            // Bottom bar & icon
            html += `
                <a-plane color="#00D9FF" width="${w}" height="0.08" position="0 ${-halfHeight + 0.08} 0.01" opacity="0.7"></a-plane>
                <a-circle color="#00D9FF" radius="0.12" position="${-w/2 + 0.4} ${halfHeight - 0.25} 0.015" opacity="0.5">
                    <a-animation attribute="scale" from="1 1 1" to="1.2 1.2 1.2" dur="1500" repeat="indefinite" direction="alternate"></a-animation>
                </a-circle>
                <a-text value="ðŸ“" align="center" position="${-w/2 + 0.4} ${halfHeight - 0.25} 0.02" width="1.8" color="#FFD700"></a-text>
            `;

            return html;
        }

        // ===================================
        // HELPER MODE FUNCTIONS
        // ===================================
        function toggleHelperMode() {
            helperMode = !helperMode;
            document.getElementById('helper-status').textContent = helperMode ? 'ON' : 'OFF';
            document.querySelector('.helper-toggle-btn').classList.toggle('active');
        }

        // ===================================
        // EVENT LISTENERS
        // ===================================
        const scene = document.querySelector('a-scene');
        const camera = document.querySelector('#camera');

        // Update camera rotation display
        setInterval(() => {
            const rotation = camera.getAttribute('rotation');
            document.getElementById('camera-rotation').textContent =
                `Camera: X:${rotation.x.toFixed(1)}Â° Y:${rotation.y.toFixed(1)}Â° Z:${rotation.z.toFixed(1)}Â°`;
        }, 100);

        // Click to get coordinates
        scene.addEventListener('click', (evt) => {
            if (!helperMode) return;

            const intersection = evt.detail.intersection;
            if (intersection) {
                const point = intersection.point;
                document.getElementById('position-display').textContent =
                    `Position: X:${point.x.toFixed(2)} Y:${point.y.toFixed(2)} Z:${point.z.toFixed(2)}`;

                const cameraPos = camera.getAttribute('position');
                const dx = point.x - cameraPos.x;
                const dz = point.z - cameraPos.z;
                const angleY = Math.atan2(dx, dz) * (180 / Math.PI);
                document.getElementById('rotation-display').textContent = `Rotation: Y:${angleY.toFixed(1)}Â°`;

                // Create marker
                markerCounter++;
                const marker = document.createElement('a-entity');
                marker.setAttribute('id', `marker-${markerCounter}`);
                marker.setAttribute('position', `${point.x} ${point.y} ${point.z}`);
                marker.innerHTML = `<a-sphere color="#FFD700" radius="0.1"></a-sphere>`;
                scene.appendChild(marker);

                console.log(`Marker ${markerCounter}: (${point.x.toFixed(2)}, ${point.y.toFixed(2)}, ${point.z.toFixed(2)})`);
            }
        });

        // Checkpoint click events
        scene.addEventListener('loaded', () => {
            const checkpoints = document.querySelectorAll('.checkpoint');
            checkpoints.forEach(checkpoint => {
                checkpoint.addEventListener('click', (e) => {
                    if (!helperMode) {
                        e.stopPropagation();
                        const target = parseInt(checkpoint.getAttribute('data-target'));
                        goToImage(target);
                    }
                });
            });

            // Initialize on load
            update3DInfoPanel();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === '+' || e.key === '=') zoomIn();
            if (e.key === '-' || e.key === '_') zoomOut();
            if (e.key === '0') resetZoom();
            if (e.key === 'h' || e.key === 'H') toggleHelperMode();
            if (e.key === 'c' || e.key === 'C') {
                // Clear markers
                const markers = document.querySelectorAll('[id^="marker-"]');
                markers.forEach(m => m.remove());
                markerCounter = 0;
            }

            // Number keys 1-9 for quick navigation
            if (e.key >= '1' && e.key <= '9') {
                const imgNum = parseInt(e.key);
                if (imgNum <= CONFIG.totalImages) goToImage(imgNum);
            }
        });
    </script>
</body>
</html>
